#!/bin/bash



# allowing the certs to be accessed

ssh-keyscan -t rsa github.com  >> /root/.ssh/known_hosts

cp /root/deploykeys/$GIT_DEPLOY_KEY /root/.ssh/
cp /root/deploykeys/$GIT_DEPLOY_KEY.pub /root/.ssh/
chown root:root /root/.ssh/$GIT_DEPLOY_KEY

ls -alrt /root/.ssh/ | grep $GIT_DEPLOY_KEY


# Installing wordpress

if [ "$GIT_SSH_URL" != '' ]; then
    # from a git repository using SSH. It is assumed appropriate credentials are set up

    cd /usr/share/nginx
    git clone $GIT_SSH_URL www
fi

#  Removing the deploy key
rm /root/.ssh/$GIT_DEPLOY_KEY.pub
rm /root/.ssh/$GIT_DEPLOY_KEY

ls -alrt /root/.ssh/

# Boostraping Nginx Helper Wordpress plugin's log
mkdir -p /usr/share/nginx/www/wp-content/uploads/nginx-helper
touch /usr/share/nginx/www/wp-content/uploads/nginx-helper/nginx.log
chown www-data:www-data /usr/share/nginx/www/wp-content/uploads/nginx-helper/nginx.log
